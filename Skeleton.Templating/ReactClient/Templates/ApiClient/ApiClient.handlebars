// generated by a tool
import { get, post, postForm, del, fixJsonDate, fixNullableJsonDate } from '../../http'
import {QueryClient} from '@tanstack/react-query';
{{#each Operations}}
{{#if UsesModel}}
import { {{cs_name Name}}Model } from './{{cs_name Name}}Model'
{{/if}}
{{#each UserProvidedParameters}}
{{#if IsCustomTypeOrCustomArray}}
import { {{ResolvedTypescriptTypeUnderlying}} } from './{{ResolvedTypescriptTypeUnderlying}}'
{{/if}}    
{{/each}}    
{{/each}}
{{#each DistinctOperationReturnTypesRelatedToParent}}
import { {{cs_name Name}} } from './{{cs_name Name}}'
{{/each}}
{{#each DistinctOperationReturnTypesRelatedToOther}}
    import { {{cs_name Item1.Name}} } from '../{{kb_case Item2.Name}}/{{cs_name Item1.Name}}'
{{/each}}

export interface {{ClientApiInterfaceName}} {
{{#each ApiOperations}}
    {{#if HasCustomType}}
        {{cml_case BareName}}(model : {{#if ../IsAttachment}}FormData{{else}}{{cs_name CustomType.Name}} | null{{/if}}) : Promise<{{TypeScriptReturn}}>;
    {{else}}
        {{cml_case BareName}}({{#each UserProvidedParameters}}{{cml_case Name}} : {{ResolvedTypescriptType}} | null {{#unless @last}}, {{/unless}}{{/each}}) : Promise<{{TypeScriptReturn}}>;
    {{/if}}    
    {{/each}}    
}

export const {{ClientApiTypeName}}QueryKeys = {
{{#each ApiOperations}}
    {{#unless ChangesData}}
        {{#if HasCustomType}}
    {{cml_case BareName}}: (model : {{#if ../IsAttachment}}FormData{{else}}{{cs_name CustomType.Name}} | null{{/if}}) => ["{{cml_case Name}}", model] as const,
        {{else}}
    {{cml_case BareName}}: ({{#each UserProvidedParameters}}{{cml_case Name}} : {{ResolvedTypescriptType}} | null {{#unless @last}}, {{/unless}}{{/each}}) => ["{{cml_case Name}}"{{#each UserProvidedParameters}}, {{cml_case Name}}{{/each}}] as const,
        {{/if}}
    {{/unless}}
{{/each}}
    invalidateAll: (client: QueryClient) => {
{{#each ApiOperations}}
    {{#unless ChangesData}}
        client.invalidateQueries({queryKey: ['{{cml_case Name}}']});
    {{/unless}}
{{/each}}    
    }
};

export class {{ClientApiTypeName}} implements {{ClientApiInterfaceName}} {

	{{#each ApiOperations}}
	{{#if HasCustomType}}
	public async {{cml_case BareName}}(model : {{#if ../IsAttachment}}FormData{{else}}{{cs_name CustomType.Name}} | null{{/if}}) : Promise<{{TypeScriptReturn}}>  {
		const uri = 'api/{{kb_case ../Name}}/{{cs_name BareName}}';
		console.log("calling {{Name}} on " + uri);
		{{#if ../IsAttachment}}
		const result = await postForm<{{TypeScriptReturn}}>(uri, model);
		{{else}}
		var result = await {{ts_fix_http HttpMethod}}<{{TypeScriptReturn}}>(uri, model);
		{{/if}}
		{{#if IsStructuredResult}}
		{{#if ResultHasAnyDateFields}}
		if (result.parsedBody) {
        {{#if SingleResult}}
            let d = result.parsedBody;
        {{else}}
            for (let d of result.parsedBody) {
        {{/if}}
                {{#each SimpleReturnType.Fields}}
                {{#unless IsExcludedFromResults}}
				{{#if IsDateTime}}
				{{#if IsRequired}}
				d.{{cml_case Name}} = fixJsonDate(d.{{cml_case Name}});
				{{else}}
				d.{{cml_case Name}} = fixNullableJsonDate(d.{{cml_case Name}});
				{{/if}}
				{{/if}}
                {{/unless}}
				{{/each}}
            {{#unless SingleResult}} }{{/unless}}
        }
		{{/if}}
		{{/if}}
        {{#unless NoResult}}
        if (result.parsedBody != undefined){
            return result.parsedBody;
        } else {
        {{#if SingleResult}}
            throw new Error('No result');
        {{else}}
            if (result.status == 204){
                return {{TypeScriptDefaultReturnValue}};
            } else {
                throw new Error('Network response was not ok');
            }
        {{/if}}
        }
        {{/unless}}
	{{else}}
	public async {{cml_case BareName}}({{#each UserProvidedParameters}}{{cml_case Name}} : {{ResolvedTypescriptType}} | null {{#unless @last}}, {{/unless}}{{/each}}) : Promise<{{TypeScriptReturn}}>  { 
    {{#if ProvideDataByUri}}
        const uri = `api/{{kb_case ../Name}}/{{cs_name BareName}}?{{#each UserProvidedParameters}}{{cml_case Name}}=${({{cml_case Name}})}{{#unless @last}}&{{/unless}}{{/each}}`;
    {{else}}
        const uri = 'api/{{kb_case ../Name}}/{{cs_name BareName}}';
    {{/if}}
		console.log("calling {{Name}} on " + uri);
    {{#if ProvideDataByUri}}
        const result = await {{ts_fix_http HttpMethod}}<{{TypeScriptReturn}}>(uri);
    {{else}}
        const result = await {{ts_fix_http HttpMethod}}<{{TypeScriptReturn}}>(uri, {{#each UserProvidedParameters}}{{cml_case Name}}{{/each}});
    {{/if}}    
		{{#if IsStructuredResult}}
		{{#if ResultHasAnyDateFields}}
		if (result.parsedBody) {
        {{#if SingleResult}}
            let d = result.parsedBody;
        {{else}}
            for (let d of result.parsedBody) {
        {{/if}}
                {{#each SimpleReturnType.Fields}}
                {{#unless IsExcludedFromResults}}
				{{#if IsDateTime}}
				{{#if IsRequired}}
				d.{{cml_case Name}} = fixJsonDate(d.{{cml_case Name}});
				{{else}}
				d.{{cml_case Name}} = fixNullableJsonDate(d.{{cml_case Name}});
				{{/if}}
				{{/if}}
                {{/unless}}
				{{/each}}
            {{#unless SingleResult}} }{{/unless}}
        }
		{{/if}}
		{{/if}}
        {{#unless NoResult}}
        if (result.parsedBody != undefined){
            return result.parsedBody;
        } else {
        {{#if SingleResult}}
            throw new Error('No result');
        {{else}}
        if (result.status == 204){
            return {{TypeScriptDefaultReturnValue}};
        } else {
            throw new Error('Network response was not ok');
        }
        {{/if}}
        }
        {{/unless}}
	{{/if}}
	}

	{{/each}} 
}
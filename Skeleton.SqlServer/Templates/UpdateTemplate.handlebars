-- generated by a tool
CREATE OR ALTER PROCEDURE {{{escape_sql_keyword Namespace}}}.{{FunctionName}} 
{{#each UpdateInputFields}}
@{{{VariableName}}} {{ProviderTypeName}}{{#if HasSize}}({{SizeDisplay}}){{/if}}{{#unless @last}},{{/unless}}
{{/each}}
AS
    declare @update_count int;
    BEGIN

        UPDATE {{{escape_sql_keyword Name}}}
        SET 
            {{#each UpdateFields}}
            {{{escape_sql_keyword Name}}} = {{{Value}}}{{#unless @last}},{{/unless}}
            {{/each}}
        WHERE
        {{#each PrimaryKeyFields}}
            {{{escape_sql_keyword Parent.Name}}}.{{{escape_sql_keyword Name}}} = @{{VariableName}}{{#unless @last}} AND{{/unless}}{{/each}}{{#if SoftDelete}} AND deleted_date is NULL{{/if}};

        SET @update_count = @@ROWCOUNT;
        
        SELECT @update_count;
        
    END;
GO

REVOKE ALL ON OBJECT::{{{escape_sql_keyword Namespace}}}.{{FunctionName}} FROM public;
GO

GRANT EXECUTE ON OBJECT::{{{escape_sql_keyword Namespace}}}.{{FunctionName}} TO web_app_role;
GO

EXEC sys.sp_addextendedproperty @name=N'codegen_meta', @value=N'{"applicationtype":"{{Name}}", "generated":true, "changesData":true, "friendlyName":"Edit", "fullName":"{{FunctionName}}" {{#if NoEditUI}},"ui":false, "api":false {{/if}} }', 
    @level0type=N'SCHEMA',@level0name=N'{{Namespace}}', @level1type=N'PROCEDURE',@level1name=N'{{FunctionName}}';

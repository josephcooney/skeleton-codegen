-- generated by a tool
CREATE OR ALTER PROCEDURE {{Namespace}}.{{FunctionName}}
{{#each InsertInputFields}}
    @{{{Name}}} {{ProviderTypeName}}{{#if HasSize}}({{Size}}){{/if}}{{#if @last}}{{#if ../UsesCustomInsertType}},{{/if}}{{else}},{{/if}}
{{/each}}
{{#if UsesCustomInsertType}}
    @{{NewRecordParameterName}} {{Namespace}}.{{NewTypeName}} READONLY
{{/if}}
AS
    DECLARE @new_id {{PrimaryKeyField.ProviderTypeName}}{{#if PrimaryKeyField.HasSize}}({{PrimaryKeyField.Size}}){{/if}};
    BEGIN

		{{#if PrimaryKeyField.IsUuid}}
			@new_id = uuid_generate_v1();
		{{/if}}

        insert into {{{escape_sql Name}}} (
            {{#each InsertFields}}
            {{{escape_sql Name}}}{{#unless @last}},{{/unless}}
            {{/each}}
        )

{{#if UsesCustomInsertType}}
        SELECT 
        {{#each InsertFields}}
        {{{Value}}}{{#unless @last}},{{/unless}}
        {{/each}}
        FROM @{{NewRecordParameterName}}
{{else}}
        VALUES
        (    
            {{#each InsertFields}}
            {{{Value}}}{{#unless @last}},{{/unless}}
            {{/each}}
        );
{{/if}}

		{{#if PrimaryKeyField.IsInt}}
        SET @new_id = scope_identity();
        {{else}}
            {{#if PrimaryKeyField.IsUserEditable}}
                {{#if UsesCustomInsertType}}
        SELECT @new_id = {{PrimaryKeyField.Name}} FROM @{{NewRecordParameterName}};
                {{else}}
        SET @new_id = @{{PrimaryKeyField.Name}};
                {{/if}}
            {{/if}}          
        {{/if}}

        select @new_id;
    END;
GO

REVOKE ALL ON OBJECT::{{{escape_sql Namespace}}}.{{FunctionName}} FROM public;
GO

GRANT EXECUTE ON OBJECT::{{{escape_sql Namespace}}}.{{FunctionName}} TO web_app_role;
GO

EXEC sys.sp_addextendedproperty @name=N'codegen_meta', @value=N'{"applicationtype":"{{Name}}", "generated":true, "single_result":true, "changesData":true, "friendlyName":"Add", "fullName":"{{FunctionName}}", "createsNew":true {{#if NoAddUI}},"ui":false, "api":false {{/if}} }' , @level0type=N'SCHEMA',@level0name=N'{{Namespace}}', @level1type=N'PROCEDURE',@level1name=N'{{FunctionName}}';




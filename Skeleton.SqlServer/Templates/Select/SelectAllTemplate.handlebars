-- generated by a tool

CREATE OR ALTER PROCEDURE {{{escape_sql_keyword Namespace}}}.{{FunctionName}}
{{#each SelectInputFields}}
@{{{Name}}} {{ProviderTypeName}}{{#if HasSize}}({{Size}}){{/if}}{{#unless @last}},{{/unless}}
{{/each}}
AS
    BEGIN

        SELECT
        {{#if HasExcludedFields}}
            {{#each Fields}}
                {{../ShortName}}.{{{escape_sql_keyword Name}}}{{#unless @last}},{{/unless}}
            {{/each}}
        {{else}}
            {{ShortName}}.*
        {{/if}}
        FROM {{{escape_sql_keyword Name}}} {{ShortName}}
        {{#if SoftDelete}}
            WHERE deleted_date is NULL
        {{/if}}
        ORDER BY {{ShortName}}.{{{escape_sql_keyword PrimaryKeyField.Name}}}
    END


-- REVOKE ALL ON FUNCTION {{FunctionName}} ({{#each SelectInputFields}} {{ProviderTypeName}}{{#if HasSize}}({{Size}}){{/if}}{{#unless @last}},{{/unless}} {{/each}}) FROM public;

-- GRANT EXECUTE ON FUNCTION {{FunctionName}} ({{#each SelectInputFields}} {{ProviderTypeName}}{{#if HasSize}}({{Size}}){{/if}}{{#unless @last}},{{/unless}} {{/each}}) TO web_app_role;
GO
EXEC sys.sp_addextendedproperty @name=N'codegen_meta', @value=N'{"applicationtype":"{{Name}}", "generated":true, "fullName":"{{FunctionName}}"}' , @level0type=N'SCHEMA', @level0name=N'{{Namespace}}', @level1type=N'PROCEDURE', @level1name=N'{{FunctionName}}';




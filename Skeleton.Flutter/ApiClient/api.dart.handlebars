// generated by a tool
import 'dart:convert';
import 'package:http/http.dart' as http;
import 'package:flutter_application_1/api/api_constants.dart';

{{#each ApiOperations}}
    {{#if HasCustomType}}
import '../model/{{snake_case ../Name}}/{{CustomType.DartFileName}}.dart';        
    {{/if}}
{{/each}}
{{#each DistinctOperationReturnTypesRelatedToParent}}
import '../model/{{snake_case ../Name}}/{{snake_case Name}}.dart';
{{/each}}
{{#each DistinctOperationReturnTypesRelatedToOther}}
import '../model/{{snake_Case Item2.Name}}/{{snake_case Item1.Name}}.dart';
{{/each}}

class {{ClientApiTypeName}} {

	{{#each ApiOperations}}
	{{#if HasCustomType}}
	Future<{{{DartReturn}}}> {{cml_case BareName}}({{#if ../IsAttachment}}FormData{{else}}{{cs_name CustomType.Name}}{{/if}} model) async {
		var uri = "$baseAddress/api/{{kb_case ../Name}}/{{cs_name BareName}}";
		print("calling {{Name}} on " + uri);
		{{#if ../IsAttachment}}
		final response = await postForm<{{TypeScriptReturn}}>(uri, model);
		{{else}}
		final response = await http.{{lc HttpMethod}}(Uri.parse(uri), headers: ApiUtil.getHeaders(), body: model.toJson());
		{{/if}}
		{{#if IsStructuredResult}}
		{{#if ResultHasAnyDateFields}}
        if (ApiUtil.responseStatusIsSuccess(response.statusCode)){

        }            
		if (result.parsedBody) {
        {{#if SingleResult}}
            let d = result.parsedBody;
        {{else}}
            for (let d of result.parsedBody) {
        {{/if}}
                {{#each SimpleReturnType.Fields}}
                {{#unless IsExcludedFromResults}}
				{{#if IsDateTime}}
				{{#if IsRequired}}
				d.{{cml_case Name}} = fixJsonDate(d.{{cml_case Name}});
				{{else}}
				d.{{cml_case Name}} = fixNullableJsonDate(d.{{cml_case Name}});
				{{/if}}
				{{/if}}
                {{/unless}}
				{{/each}}
            {{#unless SingleResult}} }{{/unless}}
        }
		{{/if}}
		{{/if}}
		return result;
	{{else}}
	Future<{{{DartReturn}}}> {{cml_case BareName}}({{#each UserProvidedParameters}} {{{ResolvedDartType}}} {{cml_case Name}}{{#unless @last}}, {{/unless}}{{/each}}) async { 
    {{#if ProvideDataByUri}}
        var uri = "$baseAddress/api/{{kb_case ../Name}}/{{cs_name BareName}}?{{#each UserProvidedParameters}}{{cml_case Name}}=${({{cml_case Name}})}{{#unless @last}}&{{/unless}}{{/each}}";
    {{else}}
        var uri = "$baseAddress/api/{{kb_case ../Name}}/{{cs_name BareName}}";
    {{/if}}
        print("calling {{Name}} on " + uri);
    {{#if ProvideDataByUri}}
        final response = await http.{{lc HttpMethod}}(Uri.parse(uri));
    {{else}}
        final response = await http.{{lc HttpMethod}}(Uri.parse(uri), {{#each UserProvidedParameters}}{{cml_case Name}}{{/each}});
    {{/if}}
    if (ApiUtil.responseStatusIsSuccess(response.statusCode)){
    {{#if ResultHasAnyDateFields}}
        {{#if SingleResult}}
            return {{{DartReturn}}}.fromJson(jsonDecode(response.body));
        {{else}}
            // decode array
        {{/if}}    
    {{/if}}    
    }
    {{#if IsStructuredResult}}
		{{#if ResultHasAnyDateFields}}
		if (result.parsedBody) {
        {{#if SingleResult}}
            let d = result.parsedBody;
        {{else}}
            for (let d of result.parsedBody) {
        {{/if}}
                {{#each SimpleReturnType.Fields}}
                {{#unless IsExcludedFromResults}}
				{{#if IsDateTime}}
				{{#if IsRequired}}
				d.{{cml_case Name}} = fixJsonDate(d.{{cml_case Name}});
				{{else}}
				d.{{cml_case Name}} = fixNullableJsonDate(d.{{cml_case Name}});
				{{/if}}
				{{/if}}
                {{/unless}}
				{{/each}}
            {{#unless SingleResult}} }{{/unless}}
        }
		{{/if}}
		{{/if}}
		return result;
	{{/if}}
	}

	{{/each}} 

}